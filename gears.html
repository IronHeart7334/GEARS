<!DOCTYPE html>
<html>
    <head>
        <title> GEARS </title>
        <meta name="Creator" content="Matt Crow">
        <script src="scripts/utilities.js"></script>
        <script src="scripts/canvas.js"></script>
        <script src="scripts/entity.js"></script>
        <script src="scripts/block.js"></script>
        <script src="scripts/jump.js"></script>
        <script src="scripts/machines.js"></script>
        <script src="scripts/player.js"></script>
        <script src="scripts/level.js"></script>
        <script src="levelData/levels.js"></script>
        <style>
            div {
                border-style: groove;
                border-width: 10px;
            }
            #controls {
                position:absolute;
                left:1120px;
                top:220px;
                width:100px;
                height:880px;
                text-align: center;
            }
        </style>
        
        <script>
            var FPS = 20;
            function blocksPerSecond(blocks){
                return BLOCK_SIZE * blocks / FPS;
            }
            // Variable globalization
            var current_level;
            var GRAVITY = blocksPerSecond(3);
            var game_timer;
            var timer_started;
            
            
            function pause() {
                clearInterval(game_timer);
                timer_started = false;
            }
            
            function resume() {
                game_timer = setInterval(update_frame, 1000 / FPS);
                timer_started = true;
            }
            
            function assign_color(changes) {
                for (var alter of changes) {
                    var change = document.getElementById(alter[0]);
                    change.style.background = alter[1];
                    change.style.borderColor = alter[2];     
                }
            }

            function load_game() {
                //load_canvas();
                current_level.load();
                current_level.play(player);
                resume();
            }

            function keyDown(event){
                //console.log(event.key + " down");
                switch(event.key){
                    case 'a':
                        player.moveLeft();
                        break;
                    case 'd':
                        player.moveRight();
                        break;
                    case 'w':
                        player.jump();
                        break;
                    case 'Shift':
                        player.shiftGear();
                        break;
                    case 'p':
                        if (timer_started){
                                        pause();
                                } else {resume();}
                                break;
                }
            }
            function keyUp(event){
                //console.log(event.key + " up");
                switch(event.key){
                    case 'a':
                        player.stop();
                        break;
                    case 'd':
                        player.stop();
                        break;
                }
            }

            document.addEventListener("keydown", keyDown);
            document.addEventListener("keyup", keyUp);

            function update_frame() {
                canvas.fillStyle = "black";
                canvas.fillRect(0, 0, canvas_size, canvas_size);

                update_camera();
                player.update();
                current_level.update();

                current_level.draw();
                player.draw();

                reset_camera();

                player.drawHUD();
            }
            
            var player = new Player();
        </script>
    </head>
    
    <body onload="load_page(); load_game(); assign_color([['controls', silver(7), color2]]);" id="body">
        <div id="controls">
        	<h2>Controls</h2>
        	
        	<h3>W</h3>
        	<p>Jump</p>
        	
        	<h3>Shift</h3>
        	<p>Change gears</p>
        	
        	<h3>A:</h3>
        	<p>Move left</p>
        	
        	<h3>D:</h3>
        	<p>Move right</p>
        	
        	<h3>P</h3>
        	<p>Pause/unpause</p>
        	<i>Bugged</i>
        </div>
        
    </body>
</html>
